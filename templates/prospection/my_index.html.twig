{% extends 'base.html.twig' %} {% block title %}
  {{ controller_name }}
{% endblock %}

{% block body %}
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Toutes ses prospections</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item">
                <a href="#">Accueil</a>
              </li>
              <li class="breadcrumb-item active">Toutes mes prospections</li>
            </ol>
          </div>
        </div>
      </div>
      <!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">

          <div class="col-12">

            <!-- DONUT CHART -->
            <div class="card card-secondary">
              <div class="card-header">
                <h3 class="card-title">Information du commercial et Progression journalier</h3>

                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="card-body row">
                <div class="col-md-6">
                    <div class="row"> <div class="col-3" > Nom :</div> <span >{{ particulier.getNom }}</span> </div><hr>
                    <div class="row"> <div class="col-3" > Prenom(s) :</div> <span >{{ particulier.getPrenoms }} </span> </div><hr>
                    <div class="row"> <div class="col-3" >Tel :</div> <span >{{ particulier.getNumTel }}</span></div><hr>
                     <div class="row"> <div class="col-3" >Email :</div> <span >{{ particulier.getUser.getEmail }}</span></div><hr>
                    <div class="row"> <div class="col-3" > Type :</div> <span >{{ particulier.getProfilLibelle ?? "inconnu"}}</span> </div><hr>
                </div>
                <div class="col-md-6">
                    <canvas id="donutChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
              
              </div>
              <!-- /.card-body -->
            </div>
          
        

            <!-- /.card -->
          </div>
            
          <div class="col-12">
           
           {% for key ,prospections in prospectionsByDay %}
                <div class="card">
                <div class="card-header  d-flex">
                    <h3 class="card-title">{{key|date("d-m-Y")}}</h3>
                    <div class="ml-auto">
                    <form action="{{path('prospections.validated',{id:(prospections|first ).getParticulier.getId})}}" method="post">
                        <input type="hidden" name="date" value="{{key}}">
                        <button type="submit" class="btn  btn-primary"> Valider</button>
                    </form>
                     
                    </div>
                </div>
                <!-- /.card-header -->
                <div class="card-body">
                    {% if prospections != null %}
                    <table  class="table table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>Nom Enseigne</th>
                            <th>Nom Entreprise</th>
                            <th>Auteur</th>

                            <th>Potentiel</th>
                            <th>Etat</th>

                            <th class="text-right">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for prospection in prospections %}
                            <tr>
                            <td>{{ prospection.getEnseigne.getNomEnseigne }}</td>

                            <td>{{ prospection.getEntreprise.getNomEntreprise }}</td>
                            <td>{{ prospection.getParticulier.getNomPrenoms }}</td>
                            {# <td>
                                {% if prospection.getEnseigne.getIsValidated %}
                                <span class="badge badge-success">Activé</span>
                                {% else %}
                                <span class="badge badge-secondary">Désactivé</span>
                                {% endif %}
                            </td> #}
                            <td>
                            {% if prospection.getPotentiel %}
                                {{prospection.getPotentiel.getLibelle}}
                            {% else %}
                            inconnu
                            {% endif %}
                            </td>
                            <td>
                                {% if prospection.isStatus %}
                                <span class="badge badge-success">Validéé</span>
                                {% else %}
                                <span class="badge badge-secondary">En attente</span>
                                {% endif %}
                                </td>
                                

                            <td class="text-right">
							  <a href="{{path('prospections.chp', {'id': prospection.getUser.getId ,  'ne': prospection.getEnseigne.getCodeEnseigne})}}" class="btn btn-sm btn-primary" role="button">
						   Générer mot de Passe
                            </a>
                                <button type="button" data-toggle="modal" data-target="#modal{{ prospection.getId }}" class="btn btn-sm btn-primary">Detail</button>
                                <a href="{{ path('prospections.decouvertes.create', { id: prospection.getId }) }}" class="btn btn-sm btn-primary" role="button">
                                
                                {% if prospection.getDecouvertes|length >0 %} Fiche  Découverte {% else %} Faire  Découverte {% endif %}
                                </a>
                        
                            </td>

                        
                            <div class="modal fade" id="modal{{ prospection.getId }}" style="display: none;" aria-hidden="true">
                        <div class="modal-dialog modal-md">
                          <div class="modal-content">
                            <div class="modal-header badge badge-secondary">
                              <h5 class="modal-title">Les informations sur le client</h5>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body">
                              {% if prospection.getEnseigne %}
                                {% set enseigne = prospection.getEnseigne %}

                                <div>
                                  Nom de l'Enseigne : <b>{{ enseigne.getNomEnseigne }}</b>
                                  <hr />Nom du propriétaire : <b>{{ enseigne.getEntreprise.getNom }}</b>
                                  <hr />Prénoms du propriétaire: <b>{{ enseigne.getEntreprise.getPrenoms }}</b>
                                
                                  <hr />Email entreprise:  <b>{{ enseigne.getEntreprise.getUser.getEmail }}</b>
                                  <hr />Nom entreprise : <b>{{ enseigne.getEntreprise.getNomEntreprise }}</b>
                                  <hr />Numéro de téléphone : <b>{{ enseigne.getEntreprise.getNumTel }}</b>
                                  <hr />Login: <b>{{ enseigne.getEntreprise.getNumTel }}</b>
                                  <hr />Mot de passe : <b>{{ enseigne.getCodeEnseigne }}</b>
                                </div>
                              {% else %}
                                <p>indisponible</p>
                              {% endif %}
                            </div>
                            <div class="modal-footer card-footer text-right py-0">
                              <button type="button" class="btn btn-default" data-dismiss="modal">fermer</button>
                            </div>
                          </div>
                          <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                      </div>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    {% endif %}
                </div>
                <!-- /.card-body -->
                </div>
            {% endfor %}

            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>

 
{% endblock %}
{% block javascripts %}
  <script src="{{asset("plugins/chart.js/Chart.min.js")}}"></script>
<script>
  $(function () {
    /* ChartJS
     * -------
     * Here we will create a few charts using ChartJS
     */

    //--------------
    //- AREA CHART -
    //--------------

 
    

    //-------------
    //- DONUT CHART -
    //-------------
    // Get context with jQuery - using jQuery's .get() method.
    var donutChartCanvas = $('#donutChart').get(0).getContext('2d')
    var donutData        = {
      labels: [
          'Nombre  de prospections actuel',
          'Nombre de prospections restant',
          
      ],
      datasets: [
        {
          data: [{{prosPerDayNow}},{{prosPerDay}}- {{prosPerDayNow}}],
          backgroundColor : [ '#00a65a', '#d2d6de'],
        }
      ]
    }
    var donutOptions     = {
      maintainAspectRatio : false,
      responsive : true,
    }
    //Create pie or douhnut chart  ['#f56954', '#00a65a', '#f39c12', '#00c0ef', '#3c8dbc', '#d2d6de']
    // You can switch between pie and douhnut using the method below.
    new Chart(donutChartCanvas, {
      type: 'doughnut',
      data: donutData,
      options: donutOptions
    })

   
  })
</script>
{% endblock %}
